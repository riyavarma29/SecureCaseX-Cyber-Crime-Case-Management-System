{% load static %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<h2 class="page-title text-center">Manage Users</h2>
<div class="container mt-4">
  <div class="card p-4 shadow-sm mx-auto table-wrapper">

    <table class="table table-hover align-middle mb-3">

      <thead class="table-light">
        <tr>
          <th>Username</th>
          <th>Role</th>
          <th>Change Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.username }}</td>
          <td>
            <span class="badge 
              {% if user.role == 'admin' %} bg-danger
              {% elif user.role == 'investigator' %} bg-warning text-dark
              {% else %} bg-secondary {% endif %}">
              {{ user.role|title }}
            </span>
          </td>
        <td class="text-nowrap">
          <form method="post" class="d-flex gap-2 align-items-center">
            {% csrf_token %}
            <input type="hidden" name="user_id" value="{{ user.id }}">

            <select name="role" class="form-select form-select-sm" style="width:140px;">
              <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
              <option value="investigator" {% if user.role == 'investigator' %}selected{% endif %}>Investigator</option>
              <option value="analyst" {% if user.role == 'analyst' %}selected{% endif %}>Analyst</option>
            </select>
            <td>
              <button type="submit" name="action" value="update" class="btn btn-sm btn-primary">
              Update
            </button>

            {% if user.role != 'admin' %}
            <button type="submit"
                    name="action"
                    value="delete"
                    class="btn btn-sm btn-outline-danger"
                    onclick="return confirm('Are you sure you want to delete this user?');">
              Delete
            </button>
            {% else %}
            <button class="btn btn-sm btn-outline-secondary" disabled>
              Delete
            </button>
            {% endif %}
            </td>
            
          </form>
        </td>


        </tr>
        {% endfor %}
        </tbody>
        </table>

    <!-- ✅ Button now sits exactly below the table -->
    <div class="text-start">
      <a href="{% url 'dashboard' %}" class="btn btn-secondary">
        ⬅ Back to Dashboard
      </a>
    </div>

  </div>
</div>
